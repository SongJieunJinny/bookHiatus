<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bookGap.mapper.mypageMapper">
  <select id="selectUserById" parameterType="String" resultType="com.bookGap.vo.MypageVO">
    SELECT 
	  	u.USER_ID          AS userId,
	    u.USER_PW          AS userPw,
	    u.USER_NAME        AS userName,
	    u.USER_EMAIL       AS userEmail,
	    u.USER_PHONE       AS userPhone,
	    u.USER_STATE       AS userState,
	    u.USER_JOIN_DATE   AS userJoinDate,
	    ua.POST_CODE AS postCode,
	    ua.ROAD_ADDRESS   AS roadAddress,
	    ua.DETAIL_ADDRESS   AS detailAddress
	  	FROM USER u
	  	LEFT JOIN USER_ADDRESS ua ON u.USER_ID = ua.USER_ID
	  		AND ua.IS_DEFAULT  = 1
	  	WHERE u.USER_ID = #{userId}
  </select>
  
  
	<update id="userUpdate" parameterType="com.bookGap.vo.MypageVO">
	  UPDATE USER
	     SET USER_NAME = #{userName},
	         USER_PHONE = #{userPhone},
	         USER_EMAIL = #{userEmail}
	   WHERE USER_ID = #{userId}
	</update>
	
	
	<update id="userPwUpdate" parameterType="com.bookGap.vo.MypageVO">
		UPDATE USER 
			 SET USER_PW = #{userPw}
		 WHERE USER_ID = #{userId}
	</update>
	
		
	<!-- 기본 주소 존재 여부 -->
	<select id="countDefaultAddressByUserId" parameterType="string" resultType="int">
		  SELECT COUNT(*) 
		  	FROM USER_ADDRESS 
		  WHERE USER_ID = #{userId} AND IS_DEFAULT = 1
	</select>
	
	<!-- 기본 주소 업데이트 -->
	<update id="updateDefaultAddress" parameterType="com.bookGap.vo.MypageVO">
		  UPDATE USER_ADDRESS
		     SET POST_CODE = #{postCode},
		         ROAD_ADDRESS = #{roadAddress},
		         DETAIL_ADDRESS = #{detailAddress},
		         USER_NAME = #{userName},
		         USER_PHONE = #{userPhone}
		   WHERE USER_ID = #{userId}
		     AND IS_DEFAULT = 1
	</update>
	
	
	<!-- 기본 주소 신규 등록 -->
	<insert id="insertDefaultAddress" parameterType="com.bookGap.vo.UserAddressVO">
		  INSERT INTO USER_ADDRESS
		    (ADDRESS_NAME, POST_CODE, ROAD_ADDRESS, DETAIL_ADDRESS, IS_DEFAULT,
		     USER_ID, USER_NAME, USER_PHONE)
		  VALUES
		    ('기본 배송지', #{postCode}, #{roadAddress}, #{detailAddress}, 1,
		     #{userId}, #{userName}, #{userPhone})
	</insert>
	 

</mapper>